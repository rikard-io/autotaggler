webpackJsonp([1],{0:function(t,e){},"1Zu3":function(t,e){},"7Otq":function(t,e,n){t.exports=n.p+"static/img/logo.51ad204.png"},"9YF1":function(t,e){},"9dgC":function(t,e){},Eq4o:function(t,e){},JaLt:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("img",{attrs:{id:"logo",src:n("7Otq")}}),this._v(" "),e("router-view")],1)},staticRenderFns:[]};var r=n("VU/8")({name:"App"},i,!1,function(t){n("9dgC")},null,null).exports,o=n("/ocq"),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"hello"},[e("h2",[this._v("- Drag some audio files to the dropzone ...")]),this._v(" "),e("div",{attrs:{id:"drop_zone"},on:{dragover:this.cancelEvent,dragenter:this.cancelEvent,drop:this.dropHandler}})])},staticRenderFns:[]};var l=n("VU/8")({name:"Start",methods:{cancelEvent:function(t){t.preventDefault()},dropHandler:function(t){var e=this;t.preventDefault();var n=[];if(t.dataTransfer.items){for(var a=0;a<t.dataTransfer.items.length;a++)if("file"===t.dataTransfer.items[a].kind){var i=t.dataTransfer.items[a].getAsFile();n.push(i)}}else for(a=0;a<t.dataTransfer.files.length;a++)n.push(t.dataTransfer.files[a]);this.$store.dispatch({type:"addFiles",files:n}).then(function(){e.$router.push({path:"addTags"})})}}},s,!1,function(t){n("Eq4o")},"data-v-a357f5e8",null).exports,d=new a.a,c={name:"Tag",props:["tag"],data:function(){return{selected:!1}},computed:{keyMap:function(){return this.$store.getters.keymapForTag(this.tag)}},mounded:function(){d.$on("TAG::SELECT_TAG",this.deselect)},destroyed:function(){d.$off("TAG::SELECT_TAG",this.deselect)},methods:{mapKey:function(t){var e=t.key;this.$store.dispatch({type:"mapKeyToTag",tag:this.tag,key:e})},deselect:function(){this.selected=!1},select:function(t){d.$emit("TAG::SELECT_TAG"),this.selected=!0},remove:function(t){this.$store.dispatch({type:"removeTag",tag:this.tag})}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tag",class:{selected:t.selected},attrs:{tabindex:"0"},on:{keyup:t.mapKey,blur:t.deselect,click:t.select}},[n("span",{ref:"tagName"},[t._v(t._s(t.tag))]),t._v(" "),n("button",{on:{click:t.remove}},[t._v("[💥]")]),t._v(" "),t.keyMap&&"undefined"!==t.keyMap?n("span",{staticClass:"keymap-lbl"},[t._v("["+t._s(t.keyMap)+"]")]):t._e()])},staticRenderFns:[]};var f={name:"AddTags",components:{InputTag:n("VU/8")(c,u,!1,function(t){n("k0gf")},"data-v-2fdfe226",null).exports},data:function(){return{}},computed:{tags:function(){return this.$store.getters.tags},onlyAllowOne:{get:function(){return this.$store.getters.onlyAllowOne},set:function(t){return this.$store.dispatch({type:"updateOnlyAllowOne",v:t})}}},methods:{addTag:function(t){var e=this.$refs.tagInput.value;this.$refs.tagInput.value="",-1===this.tags.indexOf(e)&&this.$store.dispatch({type:"addTag",tag:e})}}},h={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"addtags"},[n("p",[t._v(" - 🔥 hOt tip! click select a tag and map to a keyboard button! 🏇🔥")]),t._v(" "),n("h2",[t._v("- Let's add some tags")]),t._v(" "),n("input",{ref:"tagInput",attrs:{type:"text",placeholder:"grandma"},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.addTag(e):null}}}),t._v(" "),n("div",{staticClass:"tags-container"},t._l(t.tags,function(t){return n("InputTag",{staticClass:"tag",attrs:{tag:t}})})),t._v(" "),n("label",[t._v("\n    Limit selection to one:"),n("br"),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.onlyAllowOne,expression:"onlyAllowOne"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.onlyAllowOne)?t._i(t.onlyAllowOne,null)>-1:t.onlyAllowOne},on:{change:function(e){var n=t.onlyAllowOne,a=e.target,i=!!a.checked;if(Array.isArray(n)){var r=t._i(n,null);a.checked?r<0&&(t.onlyAllowOne=n.concat([null])):r>-1&&(t.onlyAllowOne=n.slice(0,r).concat(n.slice(r+1)))}else t.onlyAllowOne=i}}}),n("br"),t._v("\n    (and allow for the tag-bot 🤖 to do your work!)\n  ")]),t._v(" "),n("div",[n("router-link",{staticClass:"huge-ass",attrs:{to:"/tagging/0",tag:"button",disabled:this.tags.length<2}},[t._v("Let's tag!")])],1)])},staticRenderFns:[]};var g=n("VU/8")(f,h,!1,function(t){n("JaLt")},"data-v-6cb1242a",null).exports,p=n("mvHQ"),v=n.n(p),m={name:"Tag",props:["isSelected","tag"],data:function(){return{selected:!1}},computed:{keyMap:function(){return this.$store.getters.keymapForTag(this.tag)}},mounted:function(){document.addEventListener("keyup",this.keydown,!1)},destroyed:function(){document.removeEventListener("keyup",this.keydown,!1)},watch:{isSelected:function(t){this.selected=t}},methods:{keydown:function(t){t.key===this.keyMap&&this.select()},select:function(t){this.selected=!this.selected,this.selected?this.$emit("select",this.tag):this.$emit("deselect",this.tag)},remove:function(t){this.$store.dispatch({type:"removeTag",tag:this.tag})}}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tag",class:{selected:t.selected},on:{click:t.select}},[n("span",[t._v(t._s(t.tag))]),t._v(" "),t.keyMap&&"undefined"!==t.keyMap?n("span",{staticClass:"keymap-lbl"},[t._v("["+t._s(t.keyMap)+"]")]):t._e()])},staticRenderFns:[]};var T=n("VU/8")(m,y,!1,function(t){n("1Zu3")},"data-v-4ac8a342",null).exports,_={},k={install:function(t,e){t.prototype.$fileContainer=this},hash:function(t){var e=t.lastModified+"-"+t.size+"-"+t.name;return e},add:function(t){var e=this.hash(t);return _[e]=t,e},get:function(t){return _[t]},getFiles:function(){return _}},w=n("//Fk"),A=n.n(w),b=n("n9X+"),F=n("6Dki"),O=n("glSc"),C={findAbsMax:function(t){for(var e=0,n=-1,a=0,i=t.length;a<i;a++){var r=Math.abs(t[a]);r>e&&(e=r,n=a)}return n},windowArrays:function(t,e){for(var n=t.length,a=Math.floor(.5*n),i=0;i<a;i++){var r=i/a,o=t[a+i],s=e[i];t[a+i]=o*(1-r)+s*r,e[i]=o*(1-r)+s*r}},normalize:function(t){var e=1-this.findAbsMax(t);return t.map(function(t){return t*e})},resample:function(t,e){return t.length===e?t:t.length>e?this.downSample(t,e):t.length<e?this.updsample(t,e):void 0},downSample:function(t,e){for(var n=e/t.length,a=Math.ceil(t.length*n),i=Number.MIN_VALUE,r=new Float32Array(t.length/a),o=0,s=r.length;o<s;++o){for(var l=0,d=o*a,c=d+a;d<c;++d)l+=t[d];r[o]=l/a,i=Math.max(i,Math.abs(r[o]))}for(o=0;o<s;++o)r[o]=r[o]/i;return r},lerp:function(t,e,n){return t+(e-t)*n},updsample:function(t,e){for(var n=new Float32Array(e),a=t.length/e,i=0,r=0;r<e;r++){var o=Math.floor(i),s=Math.min(t.length,o+1),l=i-o,d=this.lerp(t[o],t[s],l);n[r]=d,i+=a}return n}},x={drawLabel:function(t,e,n){var a=t.getContext("2d");a.fillStyle=n||"#000",a.fillText(e,10,10)},drawFFT:function(t,e){for(var n=t.getContext("2d"),a=.5*e.length,i=(e.length,t.height/a),r=(analyze_dsp.findAbsMax(e.real),0);r<a;r++){var o=Math.sqrt(e.real[r]*e.real[r]+e.imag[r]*e.imag[r]);n.fillStyle="rgba("+o+","+o+","+o+",1)",n.fillRect(0,t.height-r*i,t.width,i)}},drawSpectrum:function(t,e){var n=t.getContext("2d"),a=.5*e[0].length;n.fillStyle="#000",n.fillRect(0,0,t.width,t.height);for(var i=t.height/a,r=t.width/e.length,o=0;o<e.length;o++)for(var s=0;s<a;s++){var l=e[o][s],d=Math.min(255,Math.floor(l));n.fillStyle="rgba("+d+","+d+","+d+",1)",n.fillRect(o*r,s*i,2*r,i)}},drawPeaks:function(t,e,n,a){var i=t.width/e.length,r=t.getContext("2d"),o=t.height;r.fillStyle=a||"rgba(255,0,0,0.2)";for(var s=0;s<n.length;s++){var l=n[s];r.fillRect(l*i,0,2,o)}},drawSilences:function(t,e,n){var a=t.width/e.length,i=t.getContext("2d"),r=t.height;i.strokeStyle="rgba(255,0,0,0.2)",i.beginPath();for(var o=0;o<n.length;o++){var s=n[o];i.rect(s.startSamples*a,0,s.endSamples*a,r)}i.stroke()},drawEnvelope:function(t,e,n,a,i){var r=t.getContext("2d"),o=t.height,s=t.width;r.strokeStyle=a||"#AAA";var l=r.globalCompositeOperation;r.beginPath(),r.moveTo(0,o);for(var d=0;d<e.length;d++){var c=e[d].i/n*s,u=o-e[d].value*o;r.lineTo(c,u)}r.stroke(),r.globalCompositeOperation=l},drawBuffer:function(t,e,n,a){var i=Math.floor(e.length/t.width),r=t.getContext("2d"),o=t.height,s=0;r.strokeStyle=n||"#AAA";for(var l=0;l<e.length;l+=i){var d=analyze_dsp.avg(e,l,l+i);r.beginPath(),r.moveTo(s,o),a?(r.lineTo(s,0),r.strokeStyle="rgba(0,0,0,"+d+")"):r.lineTo(s,(1-d)*o),r.stroke(),s++}}},I=(n("qSJ1"),new(window.AudioContext||window.webkitAudioContext));function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:227,n=document.createElement("canvas"),a=n.getContext("2d");return n.width=e,n.height=e,x.drawSpectrum(n,t),a.getImageData(0,0,e,e)}var M={setup:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.knn=new b.KNNImageClassifier(t,e),this.knn.load()},audioFileToFFT:function(t){return new A.a(function(e,n){var a=new FileReader,i=void 0;a.onloadend=function(){i=a.result,e(i)},a.readAsArrayBuffer(t)}).then(function(t){return I.decodeAudioData(t).then(function(t){return function(t,e,n){if(t){var a=t.getChannelData(0);a=C.normalize(a);for(var i=Math.floor(a.length/e),r=[],o=0;o<i;o++){for(var s=0,l=new O.ComplexArray(e),d=0;d<e;d++){var c=o*e+d;c<a.length&&(l.real[d]=a[c],s+=Math.abs(a[c]))}var u=l.FFT();u.__magnitude=s,u.__amp=s/e,r.push(u.magnitude())}return r}throw new Error("Clip has no buffer!")}(t,256)})})},process:function(t,e){var n=this;return this.audioFileToFFT(t).then(function(t){var a=$(t),i=F.fromPixels(a);n.knn.addImage(i,e)})},predict:function(t){var e=this;return this.audioFileToFFT(t).then(function(t){var n=F.fromPixels($(t));return e.knn.predictClass(n).then(function(t){return n.dispose(),t.classIndex})})}},E={name:"Tagging",components:{Tag:T},props:["fileId"],watch:{fileId:function(t){var e=this;setTimeout(function(){e.play()},100),this.predicted=null,M.predict(this.fileBlob).then(function(t){e.predicted=e.tags[t],e.doAutoTag&&(e.addTag(e.predicted),e.next())})}},mounted:function(){var t=this;M.setup(this.tags.length),document.addEventListener("keyup",this.keydown,!1),setTimeout(function(){t.play()},100)},destroyed:function(){document.removeEventListener("keyup",this.keydown,!1)},data:function(){return{predicted:null,doAutoTag:!1}},computed:{onlyAllowOne:function(){return this.$store.getters.onlyAllowOne},hasTag:function(){this.fileTags.length},progress:function(){var t=parseInt(this.fileId)/(this.totFileCount-1);return t},totFileCount:function(){return this.$store.getters.files.length},tags:function(){return this.$store.getters.tags},fileTags:function(){return this.$store.getters.file(this.fileId).tags},fileBlob:function(){var t=this.$store.getters.file(this.fileId);return k.get(t.hash)},fileSrc:function(){var t=this.$store.getters.file(this.fileId);if(!t)return"";if(t.path)return t.path;var e=k.get(t.hash);return window.URL.createObjectURL(e)}},methods:{autotag:function(){confirm("🤖 Me? Are you sure? I'm not your Tesla grade AI bot! I will probably make a lot of mistakes! Only proceed if no humans will get harmed from these tags.")&&(this.doAutoTag=!0,this.predicted&&this.addTag(this.predicted),this.next())},keydown:function(t){13===t.keyCode||39===t.keyCode?this.next():37===t.keyCode?this.prev():32===t.keyCode&&(this.play(),t.preventDefault(),t.stopPropagation())},play:function(){this.$refs.audio.play()},next:function(){var t=this;this.tags.indexOf(this.fileTags[0])>-1?M.process(this.fileBlob,this.tags.indexOf(this.fileTags[0])).then(function(){t.progress<1&&t.$router.push({path:"/tagging/"+(parseInt(t.fileId)+1)})}):this.progress<1&&this.$router.push({path:"/tagging/"+(parseInt(this.fileId)+1)})},prev:function(){parseInt(this.fileId)>0&&this.$router.push({path:"/tagging/"+(parseInt(this.fileId)-1)})},downloadJSON:function(){var t=prompt("filename?","mytags.json"),e="data:text/json;charset=utf-8,"+encodeURIComponent(v()(this.$store.getters.json)),n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),n.click()},removeTag:function(t){this.$store.dispatch({type:"removeFileTag",tag:t,fileId:this.fileId})},addTag:function(t){this.$store.dispatch({type:"addFileTag",tag:t,fileId:this.fileId})}}},S={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"addtags"},[n("h2",[t._v("- Alright! Let's do it")]),t._v(" "),n("div",{staticClass:"tags-container"},t._l(t.tags,function(e){return n("Tag",{class:{predicted:t.predicted==e},attrs:{isSelected:-1!==t.fileTags.indexOf(e),tag:e},on:{select:t.addTag,deselect:t.removeTag}})})),t._v(" "),n("div",[n("audio",{ref:"audio",attrs:{controls:"",src:t.fileSrc}}),n("p",[t._v("[space to re-play]")])]),t._v(" "),t.onlyAllowOne?n("div",[n("button",{staticClass:"huge-ass",attrs:{disabled:this.fileId<3},on:{click:t.autotag}},[t._v("Let the 🤖 do the work!")])]):t._e(),t._v(" "),t.progress>0?n("button",{staticClass:"huge-ass",on:{click:t.prev}},[t._v("Prev! [left-arrow]")]):t._e(),t._v(" "),t.progress<1?n("button",{staticClass:"huge-ass",on:{click:t.next}},[t._v("Next! [enter|right-arrow]")]):t._e(),t._v(" "),t.progress>=1&&t.fileTags.length?n("div",[t._v("🎇🎆🎇🎇🎆🎇🎇🎆🎇"),n("br"),t._v("You're done!"),n("br"),t._v("🎇🎆🎇🎇🎆🎇🎇🎆🎇")]):t._e(),t._v(" "),n("div",{staticClass:"progress"},[t._v(t._s(parseInt(t.fileId)+1)+"/"+t._s(t.totFileCount))]),t._v(" "),n("p",[n("button",{staticClass:"huge-ass",on:{click:t.downloadJSON}},[t._v("Gimme that JSOOOON!")])])])},staticRenderFns:[]};var L=n("VU/8")(E,S,!1,function(t){n("9YF1")},"data-v-4181a409",null).exports,R={name:"Start",mounted:function(){M.setup(2)},methods:{cancelEvent:function(t){t.preventDefault()},dropHandler:function(t){t.preventDefault();var e=[];if(t.dataTransfer.items){for(var n=0;n<t.dataTransfer.items.length;n++)if("file"===t.dataTransfer.items[n].kind){var a=t.dataTransfer.items[n].getAsFile();e.push(a)}}else for(n=0;n<t.dataTransfer.files.length;n++)e.push(t.dataTransfer.files[n]);e.forEach(function(t){return M.process(t,1)})}}},N={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"hello"},[e("h2",[this._v("- Drag some audio files to the dropzone ...")]),this._v(" "),e("div",{attrs:{id:"drop_zone"},on:{dragover:this.cancelEvent,dragenter:this.cancelEvent,drop:this.dropHandler}})])},staticRenderFns:[]};var D=n("VU/8")(R,N,!1,function(t){n("acLc")},"data-v-49ccd427",null).exports;a.a.use(o.a);var P=new o.a({routes:[{path:"/",name:"Start",component:l},{path:"/addTags",name:"AddTags",component:g},{path:"/tagging/:fileId",name:"Tagging",props:!0,component:L},{path:"/ai",name:"AIPlayground",component:D}]}),U=n("fZjL"),z=n.n(U),K=n("NYxO");a.a.use(K.a);var V={addFiles:function(t,e){e.forEach(function(e){return t.files.push({hash:e.hash,name:e.name,path:e.path,tags:[]})})},addTag:function(t,e){t.tags.push(e)},removeTag:function(t,e){var n=t.tags.indexOf(e);n>-1&&t.tags.splice(n,1)},addFileTag:function(t,e){var n=t.files[e.fileId];n.tags.push(e.tag),a.a.set(t.files,e.fileId,n)},removeFileTag:function(t,e){var n=t.files[e.fileId].tags.indexOf(e.tag);n>-1&&t.files[e.fileId].tags.splice(n,1)},removeAllFileTags:function(t,e){a.a.set(t.files[e],"tags",[])},mapKeyToTag:function(t,e){a.a.set(t.keyboardTagMap,e.key,e.tag)},removeKeyToTagMapping:function(t,e){a.a.set(t.keyboardTagMap,e,null)},updateOnlyAllowOne:function(t,e){t.onlyAllowOne=e}},j={addFiles:function(t,e){(0,t.commit)("addFiles",e.files.map(function(t){return{hash:k.add(t),name:t.name,path:t.path}}))},addTag:function(t,e){(0,t.commit)("addTag",e.tag)},removeTag:function(t,e){(0,t.commit)("removeTag",e.tag)},mapKeyToTag:function(t,e){var n=t.commit,a=t.state;n("removeKeyToTagMapping",q.keymapForTag(a)(e.tag)),-1!=="abcdefghijklmnopqrstuvwxyzåäöABCDEFGHIJKLMNOPQRSTUVWXYZÅÄÖ1234567890".indexOf(e.key)&&n("mapKeyToTag",{key:e.key,tag:e.tag})},removeFileTag:function(t,e){var n=t.commit,a=t.state;q.file(a)(e.fileId).tags.indexOf(e.tag)>-1&&n("removeFileTag",e)},addFileTag:function(t,e){var n=t.commit,a=t.state;a.onlyAllowOne&&n("removeAllFileTags",e.fileId),-1===q.file(a)(e.fileId).tags.indexOf(e.tag)&&n("addFileTag",e)},updateOnlyAllowOne:function(t,e){var n=t.commit;t.state;n("updateOnlyAllowOne",e.v)}},q={tags:function(t){return t.tags},keymapForTag:function(t){return function(e){return z()(t.keyboardTagMap).find(function(n){return t.keyboardTagMap[n]===e})}},file:function(t){return function(e){return t.files[e]}},files:function(t){return t.files},tagsForFile:function(t){return function(e){return t.files[e].tags}},json:function(t){var e={};return t.files.forEach(function(t){e[t.name]=t.tags.map(function(t){return t}),t.path&&(e[t.name].path=t.path)}),e},onlyAllowOne:function(t){return t.onlyAllowOne}},G=new K.a.Store({state:{files:[],tags:[],onlyAllowOne:!0,keyboardTagMap:{}},getters:q,actions:j,mutations:V});a.a.config.productionTip=!1,a.a.use(k),new a.a({el:"#app",router:P,store:G,components:{App:r},template:"<App/>"})},acLc:function(t,e){},k0gf:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.8cd03adc7a5ce5dfb680.js.map